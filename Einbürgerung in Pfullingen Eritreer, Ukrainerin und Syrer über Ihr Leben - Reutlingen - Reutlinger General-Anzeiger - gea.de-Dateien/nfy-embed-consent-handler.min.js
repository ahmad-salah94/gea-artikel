const nfyEmbedConsentHandler={_useNfyApi:typeof window.nfy!=="undefined",_useTcfApi:false,_currentCmp:undefined,_cmpTypes:{Unknown:0,ConsentManager:1,SourcePoint:2},_cmpFeatures:{0:{read:true,consent:false,revoke:false},1:{read:true,consent:true,revoke:true},2:{read:true,consent:true,revoke:false}},_activeTcfVendorList:{},_tcfCommandString:false,_changeListener:{},_tcfCategoryId:NFYEMBED.tcfCategoryId||null,_executeChangeListener:function(){const that=this;Object.values(this._changeListener).forEach(function(fn){if(that._useTcfApi&&that._currentCmp!==that._cmpTypes.Unknown){fn(that._activeTcfVendorList)}else{fn({...that._activeTcfVendorList,...that._getLocalConsent()})}})},_updateTcfVendorList:function(tcfData,status,getDataFromCustomCommand){if(typeof getDataFromCustomCommand==="string"){__tcfapi(getDataFromCustomCommand,2,this._updateTcfVendorList)}else{if(status===false||typeof tcfData.vendor.consents==="undefined"){window.console.warn(that.constructor.name+": error in __tcfapi");return}const currentCmps=this._currentCmp!==undefined?[this._currentCmp]:this._cmpTypes;if(currentCmps[0]!==this._cmpTypes.Unknown){for(const _currentCmp in currentCmps){switch(currentCmps[_currentCmp]){case this._cmpTypes.ConsentManager:try{this._activeTcfVendorList=__tcfapi("getCMPData").vendorConsents;if(typeof __cmp!=="undefined"&&this._currentCmp===undefined){this._currentCmp=this._cmpTypes.ConsentManager}this._executeChangeListener()}catch(e){}break;case this._cmpTypes.SourcePoint:try{__tcfapi("getCustomVendorConsents",2,data=>{for(const vendor of data.consentedVendors){this._activeTcfVendorList[vendor._id]=true}if(this._currentCmp===undefined){this._currentCmp=this._cmpTypes.SourcePoint}this._executeChangeListener()})}catch(e){}break}}}if(this._currentCmp===undefined){this._currentCmp=this._cmpTypes.Unknown}if(this._currentCmp===this._cmpTypes.Unknown){for(const consetId in tcfData.vendor.consents){if(tcfData.vendor.consents[consetId]===true){this._activeTcfVendorList[consetId]=true}}}}},_addTcfListener:function(){const that=this;if(this._useTcfApi){__tcfapi("addEventListener",2,function(tcfData,status){that._updateTcfVendorList(tcfData,status,this._tcfCommandString)})}else{window.console.warn(that.constructor.name+": __tcfapi not detected")}},_updateLocalConsent:function(vendorId,consent,ttl){ttl=ttl||63072e3;let consentData=this._getLocalConsent();let updateConsent=false;if(typeof consent==="boolean"){if(consent===true){consentData[vendorId]=(new Date).getTime()+ttl;updateConsent=true}else if(Object.hasOwn(consentData,vendorId)){delete consentData[vendorId];updateConsent=true}}if(updateConsent){localStorage.setItem("nfy-pkg-embed-consents",JSON.stringify(consentData));this._executeChangeListener()}return updateConsent},_getLocalConsent:function(){let consentData=localStorage.getItem("nfy-pkg-embed-consents");if(consentData!==null){consentData=JSON.parse(consentData)}else{consentData={}}let updateConsent=false;for(const _i in consentData){if(consentData[_i]<(new Date).getTime()){delete consentData[_i];updateConsent=true}}if(updateConsent){localStorage.setItem("nfy-pkg-embed-consents",JSON.stringify(consentData));this._executeChangeListener()}return consentData},addListener:function(name,fn){if(!Object.hasOwn(this._changeListener,name)&&typeof fn==="function"){this._changeListener[name]=fn;return true}return false},removeListener:function(name){if(Object.hasOwn(this._changeListener,name)){delete this._changeListener[name];return true}return false},hasConsent(vendorId,useLocalConsent){const useTcfApi=this._useTcfApi?useLocalConsent!==true:false;if(useTcfApi&&this._currentCmp!==undefined&&this._currentCmp!==this._cmpTypes.Unknown){if(Object.hasOwn(this._activeTcfVendorList,vendorId)){return true}}else{const localConsents=this._getLocalConsent();if(Object.hasOwn({...this._activeTcfVendorList,...localConsents},vendorId)){return true}}return false},setConsent:function(vendorId,consent,callback,ttl,useLocalConsent){const that=this;const useTcfApi=this._useTcfApi?useLocalConsent!==true:false;if(useTcfApi&&this._currentCmp!==undefined&&this._currentCmp!==this._cmpTypes.Unknown){if(this.isSupportedFeature(consent?"consent":"revoke")){switch(this._currentCmp){case this._cmpTypes.ConsentManager:if(typeof __cmp!=="undefined"){__cmp("setVendorConsent",[vendorId,consent===true?1:0]);if(typeof callback==="function"){const currentConsents=__tcfapi("getCMPData").vendorConsents;if(consent&&Object.hasOwn(currentConsents,consent)||!consent&&!Object.hasOwn(currentConsents,consent)){callback(currentConsents,true)}else{callback(currentConsents,false)}}}else{window.console.error(that.constructor.name+": Consent Manager is set but __cmp() isn't there.")}break;case this._cmpTypes.SourcePoint:if(this._tcfCategoryId){__tcfapi("postCustomConsent",2,()=>{__tcfapi("getCustomVendorConsents",2,data=>{for(const vendor of data.consentedVendors){that._activeTcfVendorList[vendor._id]=true}if(typeof callback==="function"){callback(data,success)}that._executeChangeListener()})},[vendorId],[this._tcfCategoryId],[])}else{window.console.error(that.constructor.name+": tcf is active but no tcf category is set.")}break;default:window.console.error(that.constructor.name+":  unsupported cmp for writing consent.");callback(this._activeTcfVendorList,false)}}else{window.console.error(that.constructor.name+":  unsupported cmp for writing consent.");callback(this._activeTcfVendorList,false)}}else{const updatedData=this._updateLocalConsent(vendorId,consent,ttl);if(typeof callback==="function"){callback(this._getLocalConsent(),updatedData)}}},isSupportedFeature:function(feature){if(["read","consent","revoke"].indexOf(feature)!==-1){if(this._useTcfApi&&this._currentCmp!==undefined){return this._cmpFeatures[this._currentCmp][feature]}else{return true}}return false},init:function(){const that=this;if(typeof __tcfapi!=="undefined"){this._useTcfApi=true;this._addTcfListener()}let oldSchoolWaiterCount=0;const oldSchoolWaiter=setInterval(function(){if(typeof __tcfapi!=="undefined"){that._useTcfApi=true;that._addTcfListener();clearInterval(oldSchoolWaiter)}else if(oldSchoolWaiterCount>10){clearInterval(oldSchoolWaiter);that._executeChangeListener()}else{oldSchoolWaiterCount++}},500)}};if(nfyEmbedConsentHandler._useNfyApi){nfy.extend({embedConsentHandler:nfyEmbedConsentHandler})}else{nfyEmbedConsentHandler.init()}